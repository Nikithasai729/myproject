<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Students Q&A Web App</title>
<style>
  body { font-family: Arial; background: #eef3ff; margin: 0; padding: 20px; }
  h1 { text-align: center; color: #2563eb; }
  input, textarea { width: 100%; padding: 8px; margin-top: 6px; border: 1px solid #ccc; border-radius: 6px; }
  button { background: #2563eb; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; margin-top: 8px; cursor: pointer; }
  button:hover { background: #1741a1; }
  .box { max-width: 700px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px #ccc; }
  .card { background: #fafafa; border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin-top: 10px; }
  .meta { font-size: 13px; color: #555; }
  footer { margin-top: 25px; background: #f5f7ff; padding: 12px; border-radius: 10px; text-align: center; }
</style>
</head>
<body>

<h1>💬 Students Q&A Application</h1>
<div class="box">

<!-- Login/Register -->
<div id="auth">
  <h3>Login / Register</h3>
  <input id="uname" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- Main App -->
<div id="main" style="display:none">
  <h3>Ask a Question</h3>
  <input id="qtxt" placeholder="Type your question...">
  <button onclick="ask()">Post</button>

  <h3>Questions</h3>
  <div id="list"></div>

  <footer>
    <h3>👤 Profile</h3>
    <p><b>User:</b> <span id="user"></span> | <button onclick="logout()">Logout</button></p>
    <p>📝 Asked: <b id="a1">0</b> | 💡 Answered: <b id="a2">0</b> | ✏️ Edited: <b id="a3">0</b> | ❌ Deleted: <b id="a4">0</b> | ✅ Attempted: <b id="a5">0</b></p>
  </footer>
</div>
</div>

<script>
let users = JSON.parse(localStorage.users || "[]"),
    qs = JSON.parse(localStorage.qs || "[]"),
    cur = JSON.parse(localStorage.cur || "null");

const save = () => {
  localStorage.users = JSON.stringify(users);
  localStorage.qs = JSON.stringify(qs);
  localStorage.cur = JSON.stringify(cur);
};

function register(){
  let u = uname.value.trim(), p = pass.value.trim();
  if(!u || !p) return alert("Fill all fields");
  if(users.some(x => x.u === u)) return alert("User already exists");
  users.push({u, p, ask:0, ans:0, edit:0, del:0, attempt:0});
  save(); alert("Registered successfully! Please log in.");
}

function login(){
  let u = users.find(x => x.u === uname.value && x.p === pass.value);
  if(!u) return alert("Invalid credentials!");
  cur = u; save(); show();
}

function logout(){
  cur = null; save();
  auth.style.display = "block"; main.style.display = "none";
}

function show(){
  auth.style.display = "none"; main.style.display = "block";
  user.textContent = cur.u; update(); load();
}

function update(){
  a1.textContent = cur.ask || 0;
  a2.textContent = cur.ans || 0;
  a3.textContent = cur.edit || 0;
  a4.textContent = cur.del || 0;
  a5.textContent = cur.attempt || 0;
}

function ask(){
  let t = qtxt.value.trim();
  if(!t) return alert("Enter a question");
  qs.push({id: Date.now(), t, a: "", asker: cur.u, ansBy: ""});
  cur.ask++; cur.attempt++;
  users = users.map(x => x.u === cur.u ? cur : x);
  save(); qtxt.value = ""; load(); update();
}

function ans(id){
  let a = document.getElementById("ans" + id).value.trim();
  if(!a) return alert("Enter an answer");
  let q = qs.find(x => x.id === id);
  if(q.a) return alert("Already answered");
  q.a = a; q.ansBy = cur.u; cur.ans++; cur.attempt++;
  users = users.map(x => x.u === cur.u ? cur : x);
  save(); load(); update();
}

function edit(id){
  let q = qs.find(x => x.id === id);
  if(q.ansBy !== cur.u) return alert("You can only edit your own answer");
  let n = prompt("Edit your answer:", q.a);
  if(n && n.trim() !== q.a){
    q.a = n.trim(); cur.edit++; cur.attempt++;
    users = users.map(x => x.u === cur.u ? cur : x);
    save(); load(); update();
  }
}

function delQ(id){
  let q = qs.find(x => x.id === id);
  if(q.asker !== cur.u) return alert("You can only delete your own question");
  if(!confirm("Delete this question?")) return;
  qs = qs.filter(x => x.id !== id);
  cur.del++; cur.attempt++;
  users = users.map(x => x.u === cur.u ? cur : x);
  save(); load(); update();
}

function load(){
  list.innerHTML = qs.length ? qs.map(q => `
    <div class="card">
      <b>Q:</b> ${q.t}<div class="meta">Asked by: ${q.asker}</div>
      <p><b>Ans:</b> ${q.a || "<i>No answer yet</i>"}</p>
      ${q.a ? `<div class="meta">Answered by: ${q.ansBy}</div>` :
      `<textarea id="ans${q.id}" placeholder="Write answer..."></textarea><button onclick="ans(${q.id})">Submit</button>`}
      ${q.ansBy===cur?.u?`<button onclick="edit(${q.id})">Edit</button>`:""}
      ${q.asker===cur?.u?`<button onclick="delQ(${q.id})">Delete</button>`:""}
    </div>
  `).join("") : "<p>No questions yet.</p>";
}

if(cur) show();
</script>
</body>
</html>